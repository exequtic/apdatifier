#!/usr/bin/env bash

scriptDir=`cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd`

applet="com.github.exequtic.apdatifier"
configDir="$HOME/.config/apdatifier"
localDir="$HOME/.local/share"
systemAppletDir="/usr/share/plasma/plasmoids/$applet"
userAppletDir="$localDir/plasma/plasmoids/$applet"
if [[ -d "$userAppletDir" ]]; then
  appletDir="$userAppletDir"
elif [[ -d "$systemAppletDir" ]]; then
  appletDir="$systemAppletDir"
fi
tempDir="${TMPDIR:-/tmp}/apdatifier"
config="$configDir/config.conf"

export TEXTDOMAINDIR="$scriptDir/../../locale"
export TEXTDOMAIN="plasma_applet_${applet}"

source $config

while IFS= read -r line; do
    [[ -z "$line" || "$line" =~ ^[[:space:]]*# ]] && continue
    key="${line%%=*}"
    key="${key%% *}"
    value="${line#*=}"
    text=$(echo "$value" | grep -oP '(?<=\().*(?=\))' | sed 's/"//g')
    [[ -n "$key" && -n "$text" ]] && eval "$key=\"\$(gettext \"$text\")\""
done < "$scriptDir/messages"

if [[ $termFont = "true" ]]; then
    ICO_ERR=""
    ICO_DONE=""
    ICO_WARN="󱇎"
    ICO_QUESTION=""
    ICO_EXEC="󰅱"
    ICO_MIRRORS="󰓅"
    ICO_RETURN="󰬨"
    ICO_SELECT="󰄾"
else
    ICO_ERR="✘"
    ICO_DONE="✔"
    ICO_WARN="::"
    ICO_QUESTION="::"
    ICO_EXEC="::"
    ICO_MIRRORS="::"
    ICO_RETURN="<<"
    ICO_SELECT=">"
fi
