#!/bin/bash
# SPDX-FileCopyrightText: 2024 Evgeny Kazantsev <exequtic@gmail.com>
# SPDX-License-Identifier: MIT

WRAPPER=$1
# The rest of the arguments ($2, $3, etc.) are captured in a variable.
# This allows us to correctly handle the "--dbpath /path" case.
DB_ARGS="${*:2}"

# We use 'eval' so that the shell correctly interprets the DB_ARGS arguments.
# 'set -f' disables filename expansion (globbing) for greater security.
case "$WRAPPER" in
  "pikaur")
    set -f
    eval "pikaur -Qua --noconfirm $DB_ARGS" 2>&1 | grep -- '->'
    ;;
  "paru"|"yay")
    set -f
    eval "$WRAPPER -Qua $DB_ARGS"
    ;;
esac

# Exit with success (code 0) so that the plasmoid does not interpret it as an error
# if grep does not find any updates.
exit 0
